<!DOCTYPE html>
<html>
<head>
	<title>YouTube</title>
	<link rel="stylesheet" type="text/css" href="/static/css/styles.css">
	<link rel="icon" type="image/icon" href="/Resources/favicon_32x32.png" sizes="32x32">
	<script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script>
	<meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"  />
</head>
<body>
	<script>
        // 将后端传递的 username 放在这里
        const username = "{{ username }}"; 
        console.log("Username from session:", username);
    </script>

	<!--***********START OF HEADER **********-->
	<header class = "header-container stick">
		<div class = "container">
			<div class = "guide-button-box">
				<span class="iconify hamburger" data-icon="ci:hamburger" data-inline="false"></span>
			</div>
			<div class = "logo">	
				<img class = "logo-img" src = "/static/Resources/youtube_logo.webp">
				<span class = "country-code">IN</span>
			</div>
		</div>
		<div class = "search-container">
			<form action="/search" method="GET">
				<input type="text" placeholder="Search" name="user_request">
      				<button type="submit">
      					<span class="iconify search-btn" data-icon="ant-design:search-outlined" data-inline="false"></span>
      				</button>
			</form>
		</div>
		<div class="user-d">
			<button class="user-btn">
				<span class="iconify" data-icon="bx:bxs-video-plus" data-inline="false"></span>
			</button>
			<button class="user-btn">
				<span class="iconify" data-icon="gg:menu-grid-r" data-inline="false"></span>
			</button>
			<button class="user-btn">
				<span class="iconify" data-icon="fa-solid:bell" data-inline="false"></span>
			</button>
			<!--**********USER LOGIN**********-->
			<a href="/login"> <!--修改页面路径为login-->
				<button class="user-btn"> 
					<span class="iconify user" data-icon="carbon:user-avatar-filled" data-inline="false"></span>
				</button>
			</a>
		</div>
	</header>

	<!--**********END OF HEADER**********-->

	<!--**********START OF SIDEBAR**********-->

		<div class = "sidebar">
			<div class="sidebar-category" onclick="showContent('home')">
				<span class="iconify user-icon" data-icon="ci:home-alt-fill" data-inline="false"></span>
				<span>首页</span>
			</div>
			<div class="sidebar-category" onclick="showContent('myVideos')">
				<span class="iconify user-icon" data-icon="ic:baseline-video-library" data-inline="false"></span>
				<span>我的视频</span>
			</div>
			<div class="sidebar-category" onclick="showContent('subscriptions')">
				<span class="iconify user-icon" data-icon="ic:baseline-subscriptions" data-inline="false"></span>
				<span>已关注</span>
			</div>
			
			<hr/>

			<div class = "sidebar-categories">
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="ic:baseline-video-library" data-inline="false"></span>
					<span>视频库</span>
				</div>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="ic:baseline-history" data-inline="false"></span>
					<span>历史观看</span>
				</div>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="ant-design:play-square-outlined" data-inline="false"></span>
					<span>我的视频</span>
				</div>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="ic:baseline-watch-later" data-inline="false"></span>
					<span>稍后再看</span>
				</div>
				<div class = "sidebar-category">
					<a href = '/search_liked'>
						<button class = "like-button">
							<span class="iconify user-icon" data-icon="bx:bxs-like" data-inline="false"></span>
							<span>喜欢的视频</span>
						</button>
					</a>
				</div>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="ic:outline-expand-more" data-inline="false"></span>
					<span>展示更多</span>
				</div>
			</div>


			<hr/>

			<div class = "subscription-categories">
				<span class = "head-text">
					关注的人
				</span>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="carbon:user-avatar-filled" data-inline="false"></span>
					<span>Channel 1</span>
				</div>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="carbon:user-avatar-filled" data-inline="false"></span>
					<span>Channel 2</span>
				</div>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="carbon:user-avatar-filled" data-inline="false"></span>
					<span>Channel 3</span>
				</div>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="carbon:user-avatar-filled" data-inline="false"></span>
					<span>Channel 4</span>
				</div>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="carbon:user-avatar-filled" data-inline="false"></span>
					<span>Channel 5</span>
				</div>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="carbon:user-avatar-filled" data-inline="false"></span>
					<span>Channel 6</span>
				</div>
				<div class = "sidebar-category">
					<span class="iconify user-icon" data-icon="carbon:user-avatar-filled" data-inline="false"></span>
					<span>Channel 7</span>
				</div>
				<div class = "sidebar-category">
					<span class="iconify" data-icon="ic:outline-expand-more" data-inline="false"></span>
					<span>Show 40 more</span>
				</div>
			</div>

			<hr/>



			<hr/>

			<div class = "sidebar-bottom-info">
				<a href="/">关于</a>
				<span>© 2024 RUC DBMS</span>
			</div>

			<div class = "sidebar-category-sml">
				<span class="iconify user-icon selected-img" data-icon="ci:home-alt-fill" data-inline="false"></span>
				<span>Home</span>
			</div>
			<div class = "sidebar-category-sml">
				<span class="iconify user-icon" data-icon="ic:baseline-explore" data-inline="false"></span>
				<span>Explore</span>
			</div>
			<div class = "sidebar-category-sml">
				<span class="iconify user-icon" data-icon="ic:baseline-subscriptions" data-inline="false"></span>
				<span>Subscriptions</span>
			</div>
			<div class = "sidebar-category-sml">
				<span class="iconify user-icon" data-icon="ic:baseline-video-library" data-inline="false"></span>
				<span>Library</span>
			</div>
		</div>


	<!--**********END OF SIDEBAR**********-->

	<!--**********START OF HEADER NAVBAR**********-->

	<!-- <div class = "header-navbar">
		<button class = "navbar-element first active">
			All
		</button>
		<button class = "navbar-element">
			Music
		</button>
		<button class = "navbar-element">
			Wildlife
		</button>
		<button class = "navbar-element">
			Education
		</button>
		<button class = "navbar-element">
			Recently Uploaded
		</button>
		<button class = "navbar-element">
			Live
		</button>
		<button class = "navbar-element">
			Tamil
		</button>
		<button class = "navbar-element">
			T-Series
		</button>
		<button class = "navbar-element">
			Cricket
		</button>
		<button class = "navbar-element">
			Sports
		</button>
		<button class = "navbar-element">
			Eating
		</button>
		<button class = "navbar-element">
			Laughter
		</button>
		<button class = "navbar-element">
			Music
		</button>
		<button class = "navbar-element">
			Wildlife
		</button>
		<button class = "navbar-element">
			Education
		</button>
		<button class = "navbar-element">
			Recently Uploaded
		</button>
		<button class = "navbar-element">
			Live
		</button>
		<button class = "navbar-element">
			Tamil
		</button>
	</div> -->

	<!--**********END OF HEADER NAVBAR**********-->

	<!--**********START OF BOTTOM NAVBAR**********-->

	<div class = "btm-nav">
		<div>
			<button class = "btm-btn">
				<span class="iconify user-icon selected-img" data-icon="ci:home-alt-fill" data-inline="false"></span>
			</button>
			<span>Home</span>
		</div>	
		<div>
			<button class = "btm-btn">
				<span class="iconify user-icon" data-icon="ic:round-local-fire-department" data-inline="false"></span>
			</button>
			<span>Trending</span>
		</div>		
		<div>
			<button class = "btm-btn">
				<span class="iconify user-icon" data-icon="ic:baseline-subscriptions" data-inline="false"></span>
			</button>
			<span>Subscriptions</span>
		</div>		
		<div>
			<button class = "btm-btn">
				<span class="iconify user-icon" data-icon="ic:baseline-video-library" data-inline="false"></span>
			</button>
			<span>Library</span>
		</div>			
	</div>

	<!--**********END OF BOTTOM NAVBAR**********-->
	<!--**********START OF MAIN CONTENT**********-->
	<div class = "main-content" id="home">
		<div class = "videos">
			<div class = "videos-container">
				{% if videos %}
					{% for video in videos %}
						<div class = "video", onclick="playVideo('{{ video.Video_URL }}', '{{ video.video_id }}')">
							<div class = "video-thumbnail">
								<img src="{{video.picture_url}}" alt = "" />
							</div>                  
							<div class = "video-details">
								<div class = "author">
									<span class="iconify video-icon" data-icon="carbon:user-avatar-filled" data-inline="false"></span>
								</div>
								<div class = "title">
									<h3>{{video.title}}</h3>
										<a href="">Channel 1</a>
									<span>10M views • 3 Months Ago</span>
								</div>
							</div>
						</div>  
					{% endfor %}
				{% else %}
					<p>No videos available.</p> <!-- 如果没有视频数据，则显示此信息 -->
				{% endif %}         
			</div>
		</div>
	</div>		

	<!-- Video Player Modal -->
	<div id="video-player" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); z-index: 1000;">
		<div style="position: relative; top: 50%; transform: translateY(-50%); width: 80%; max-width: 960px; margin: auto; padding: 10px;">
			<div style="position: relative; width: 100%;">
				<video id="video-element" width="100%" height="auto" controls>
					<source id="video-source" type="video/mp4">
					Your browser does not support the video tag.
				</video>
				<!-- 隐藏的 video_id -->
				<input type="hidden" id="current-video-id" value="">
				<div style="position: absolute; top: 10px; right: 10px;">
					<button onclick="closePlayer()">Close</button>
				</div>
			</div>
			<div style="padding: 10px; background: #282828; color: #fff; margin-top: -40px; position: relative;">
				<div style="display: flex; align-items: center; padding-bottom: 10px;">
					<img src="/static/images/user3.jpeg" alt="Author Avatar" style="width: 50px; height: 50px; border-radius: 50%; margin-right: 10px;">
					<div>
						<h3 id="video-title" style="margin: 0; padding: 0; font-size: 16px;">Video Title</h3>
						<p id="author-name" style="margin: 0; padding: 0; font-size: 14px;">Author Name</p>
					</div>
				</div>
				<button id="delete-btn" style="background: #00b1fd; color: #fff; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Delete</button>
				<button id="like-btn" style="background: #c0c0c0; color: #fff; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin-left: 10px;">Like</button>
			</div>
		</div>
	</div>

	<!--**********END OF MAIN CONTENT**********-->
	<script type="text/javascript" src = "/static/js/script.js"></script>
	<script>
		function showContent(contentId) {
			// 隐藏所有内容区域
			var contents = document.querySelectorAll('.main-content');
			contents.forEach(function(content) {
				content.style.display = 'none';
			});
		
			// 显示点击的内容区域
			document.getElementById(contentId).style.display = 'block';
		
			// 移除所有侧边栏项的选中状态
			var categories = document.querySelectorAll('.sidebar-category');
			categories.forEach(function(category) {
				category.classList.remove('selected');
			});
		
			// 为当前点击的侧边栏项添加选中状态
			event.currentTarget.classList.add('selected');
		}
		
        function redirectToProfile() {
            // 将浏览器重定向到 user.html 页面
            window.location.href = '/user';
		}

		// 默认显示首页内容
		document.addEventListener('DOMContentLoaded', function() {
			showContent('home');

		});
	</script>

	<!--为视频的like和delete添加功能-->
	<script>
		document.getElementById("like-btn").addEventListener("click", function () {
			const videoId = document.getElementById("current-video-id").value;
		
			// 如果没有视频 ID，则提示用户
			if (!videoId) {
				alert("No video is currently being played!");
				return;
			}
		
			if (!username) {
				alert("User is not logged in!");
				return;
			}
		
			// 发送请求到后端获取 user_id
			fetch("/get_user_id", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({ username: username })
			})
			.then(response => response.json())
			.then(data => {
				if (data.user_id) {
					// 获取到 user_id 后，进行下一步操作（例如，插入喜欢视频记录）
					const userId = data.user_id;
		
					// 发送视频喜欢请求
					fetch("/add_liked", {
						method: "POST",
						headers: {
							"Content-Type": "application/json"
						},
						body: JSON.stringify({
							userId: userId,
							videoId: videoId
						})
					})
					.then(response => response.json())
					.then(data => {
						if (data.message === "Success") {
							alert("成功添加到“喜欢的视频”!");
						} else {
							alert("点赞失败!");
						}
					});
				} else {
					alert("Failed to retrieve user ID!");
				}
			})
			.catch(error => {
				console.error('Error:', error);
				alert("An error occurred!");
			});
		});
	</script>

	<script>
		document.getElementById("delete-btn").addEventListener("click", function () {
			const videoId = document.getElementById("current-video-id").value;
		
			// 如果没有视频 ID，则提示用户
			if (!videoId) {
				alert("No video is currently being played!");
				return;
			}
		
			if (!username) {
				alert("User is not logged in!");
				return;
			}
		
			// 发送删除视频请求
			fetch("/delete", {
			method: "POST",
			headers: {
				"Content-Type": "application/json"
			},
			body: JSON.stringify({
				videoId: videoId
			})
			})
			.then(response => response.json())
			.then(data => {
				if (data.message === "Success") {
					alert("视频删除成功!");
					location.href = '/'; 
					location.reload();
				} else if (data.message === "No Authorization"){
					alert("您无权限删除视频!");
					location.href = '/'; 
					location.reload();
				}
				else if (data.message === "Not Login"){
					alert("请先登录!");
					location.href = '/'; 
					location.reload();
				}
			});
			})
			.catch(error => {
				console.error('Error:', error);
				alert("An error occurred!");
			});
	</script>
</body>
</html>
